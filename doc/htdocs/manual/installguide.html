<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.6 at 2016-09-22 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20160922" />
    <meta http-equiv="Content-Language" content="en" />
    <title>SignServer &#x2013; SignServer Manual</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.5.min.js"></script>

                      </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="../index.html" id="bannerLeft">
                                                                                                <img src="../images/SignServer_pki_by_primekey.png"  alt="SignServer - Open Source server side Digital Signatures"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                  <li id="publishDate">Last Published: 2016-09-22
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 4.0.0
                      </li>
                      
              
      
                                    
    <li class="pull-right">
        <span class="divider">|</span>
                      <a href="https://www.signserver.org" title="SignServer.org">
        SignServer.org</a>
      </li>

  
    <li class="pull-right">
        <span class="divider">|</span>
                      <a href="https://www.ejbca.org/" title="EJBCA">
        EJBCA</a>
      </li>

  
    <li class="pull-right">
                      <a href="https://www.primekey.se/" title="PrimeKey Solutions">
        PrimeKey Solutions</a>
      </li>

                    </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                    <li class="nav-header">Documentation</li>
                              
      <li>
  
                          <a href="../index.html" title="Home">
          <span class="none"></span>
        Home</a>
            </li>
                
      <li>
  
                          <a href="../architecture.html" title="Architecture">
          <span class="none"></span>
        Architecture</a>
            </li>
                
      <li>
  
                          <a href="../manual.html" title="Manual Overview">
          <span class="none"></span>
        Manual Overview</a>
            </li>
                              <li class="nav-header">Manual</li>
                              
      <li>
  
                          <a href="../manual/introduction.html" title="Introduction">
          <span class="none"></span>
        Introduction</a>
            </li>
                
      <li class="active">
  
            <a href="#"><span class="none"></span>Installation Guide</a>
          </li>
                
      <li>
  
                          <a href="../manual/usageguide.html" title="Usage Guide">
          <span class="none"></span>
        Usage Guide</a>
            </li>
                
      <li>
  
                          <a href="../manual/integration.html" title="Integration">
          <span class="none"></span>
        Integration</a>
            </li>
                
      <li>
  
                          <a href="../manual/commonconf.html" title="Common Configuration">
          <span class="none"></span>
        Common Configuration</a>
            </li>
                
      <li>
  
                          <a href="../manual/plugins.html" title="Plugins">
          <span class="none"></span>
        Plugins</a>
            </li>
                
      <li>
  
                          <a href="../manual/development.html" title="Development">
          <span class="none"></span>
        Development</a>
            </li>
                
      <li>
  
                          <a href="../manual/misc.html" title="Miscellaneous">
          <span class="none"></span>
        Miscellaneous</a>
            </li>
                              <li class="nav-header">Other</li>
                              
      <li>
  
                          <a href="https://www.signserver.org" title="signserver.org">
          <span class="none"></span>
        signserver.org</a>
            </li>
            </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                                                                                                                         <a href="https://www.primekey.se/technologies/products-overview/ejbca-enterprise/" title="EJBCA - PKI by PrimeKey" class="builtBy">
        <img class="builtBy"  alt="Click the PKI-by-PrimeKey-EJBCA-logo to visit www.ejbca.org" src="../images/ejbca_pki_by_primekey.png"    />
      </a>
                                                                                                          <a href="https://www.primekey.se" title="PrimeKey Solutions" class="builtBy">
        <img class="builtBy"  alt="Click the PrimeKey logo to check out the products and services offered at www.primekey.se" src="../images/logo-PrimeKey.png"    />
      </a>
                      </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <!-- $Id: installguide.xml 7731 2016-09-15 07:43:37Z malu9369 $ -->

    
        
        <h1>Installation Guide</h1>
        
        
            
            
            
        
<ul>
<li><a href="#Server_installation">Server installation</a>
<ul>
<li><a href="#a1._Check_prerequisites">1. Check prerequisites</a></li>
<li><a href="#a2._Unpack_SignServer">2. Unpack SignServer</a></li>
<li><a href="#a3._Build_SignServer">3. Build SignServer</a></li>
<li><a href="#a4._Set_environment_variables">4. Set environment variables</a>
<ul>
<li><a href="#APPSRV_HOME">APPSRV_HOME</a></li>
<li><a href="#SIGNSERVER_NODEID">SIGNSERVER_NODEID</a></li></ul></li>
<li><a href="#a5._Setup_database">5. Setup database</a>
<ul>
<li><a href="#Database_account">Database account</a></li>
<li><a href="#Table_creation_and_indexes">Table creation and indexes</a></li>
<li><a href="#MariaDB_binlog_format_configuration">MariaDB binlog format configuration</a></li>
<li><a href="#Configure_database_driver_for_GlassFishPayara">Configure database driver for GlassFish/Payara</a></li>
<li><a href="#Configure_database_driver_for_JBoss_AS_7_JBoss_EAP_6_or_WildFly">Configure database driver for JBoss AS 7, JBoss EAP 6 or WildFly</a></li>
<li><a href="#Configure_data_source_for_GlassFishPayara">Configure data source for GlassFish/Payara</a></li>
<li><a href="#Configure_data_source_for_JBoss_AS_7.1">Configure data source for JBoss AS 7.1</a></li>
<li><a href="#Configure_data_source_for_JBoss_EAP_6_or_WildFly">Configure data source for JBoss EAP 6 or WildFly</a></li></ul></li>
<li><a href="#a6._Configure_web_server_keystores">6. Configure web server keystores</a>
<ul>
<li><a href="#GlassFishPayara_SSL_configuration">GlassFish/Payara SSL configuration</a></li>
<li><a href="#JBoss_7EAP_6_SSL_configuration">JBoss 7/EAP 6 SSL configuration</a></li>
<li><a href="#WildFly_9_SSL_configuration">WildFly 9 SSL configuration</a></li></ul></li>
<li><a href="#a7._Configure_application_server">7. Configure application server</a>
<ul>
<li><a href="#Fix_web_service_problem_in_JBoss_AS_7EAP_6WildFly">Fix web service problem in JBoss AS 7/EAP 6/WildFly</a></li>
<li><a href="#JBoss_7_and_Oracle_JDK_BouncyCastle_issues">JBoss 7 and Oracle JDK BouncyCastle issues</a></li>
<li><a href="#Fix_XML_Security_library_issue_1_in_JBoss_7">Fix XML Security library issue 1 in JBoss 7</a></li>
<li><a href="#Fix_XML_Security_library_issue_2_in_JBoss_7">Fix XML Security library issue 2 in JBoss 7</a></li>
<li><a href="#Commons_Collections_Security_issue_in_JBoss_7_and_earlier">Commons Collections Security issue in JBoss 7 and earlier</a></li>
<li><a href="#Fix_Security_issues_in_JBoss_EAP">Fix Security issues in JBoss EAP</a></li>
<li><a href="#Install_Hibernate_in_GlassFish_3">Install Hibernate in GlassFish 3</a></li></ul></li>
<li><a href="#a8._Configure_deployment">8. Configure deployment</a>
<ul>
<li><a href="#Database_configuration">Database configuration</a></li></ul></li>
<li><a href="#a9._Deploy_SignServer">9. Deploy SignServer</a></li>
<li><a href="#a9._Accessing_SignServer">9. Accessing SignServer</a>
<ul>
<li><a href="#Command_Line_Interface">Command Line Interface</a></li>
<li><a href="#Graphical_User_Interface">Graphical User Interface</a></li>
<li><a href="#Web_Interface">Web Interface</a></li></ul></li></ul></li>
<li><a href="#Signer_setup">Signer setup</a>
<ul>
<li><a href="#Loading_signers">Loading signers</a>
<ul>
<li><a href="#setproperties">setproperties</a></li></ul></li>
<li><a href="#Quick_start_demo_setup">Quick start demo setup</a>
<ul>
<li><a href="#Setup_a_sample_crypto_token">Setup a sample crypto token</a></li>
<li><a href="#Add_sample_workers">Add sample workers</a></li></ul></li>
<li><a href="#Quick_start_demo_Timestamp_signer">Quick start demo Timestamp signer</a></li>
<li><a href="#Quick_start_demo_PDF_signer">Quick start demo PDF signer</a></li>
<li><a href="#Quick_start_demo_XML_validator">Quick start demo XML validator</a></li>
<li><a href="#Quick_start_demo_MRTD_SOD_signer">Quick start demo MRTD SOD signer</a>
<ul>
<li><a href="#Production_configuration_with_HSM">Production configuration with HSM</a></li></ul></li></ul></li>
<li><a href="#Upgrade">Upgrade</a></li></ul>


            
<div class="section">
<h2><a name="Server_installation"></a>Server installation</h2>
                
                
<div class="frame note">
                        
<div class="label">Note</div>
                        
<div class="content">Make sure you are reading the version of the manual corresponding to the
software version you are about to install. The version of the manual is written
in the top of this page. See doc/README.txt within the release package for
information about how to build this manual for your version.</div>
                </div>
                
                
<div class="section">
<h3><a name="a1._Check_prerequisites"></a>1. Check prerequisites</h3>
                    
<p>
Make sure all required softwares are installed:
                    </p>
                    
<ul>
                        
<li>Java: OpenJDK 7, Oracle JDK 7* or OpenJDK 8**</li>
                        
<li>Application server: JBoss AS 7.1.1, JBoss EAP 6.x, GlassFish Server Open Source Edition 3.1.2, WildFly 9 or Payara Server 4.1.1.162***</li>
                        
<li>Database: MySQL or MariaDB 5.5, PostgreSQL 9.x, Oracle Database 10/11g or without****</li>
                        
<li>Deployment tool: Apache Ant 1.8.0 or later</li>
                        
<li>Build tool (optional*****): Apache Maven 3</li>
                    </ul>
                    
<p>
* When using Oracle JDK you must install the 'Unlimited Strength Jurisdiction Policy Files' for JDK for the parts of SignServer that  makes use of strong crypto to work. The policy files can be found at the same place as the JDK download at Oracle. Further information on this can be found in the Oracle documentation on the JCE. <br />
** If supported by the application server.<br />
*** Experimental support for Payara. Currently uses EclipseLink instead of Hibernate.<br />
**** See <a href="misc.html#SignServer_without_Database">SignServer without Database</a><br />
***** Only required when building the software from source
                    </p>
                </div>

                
<div class="section">
<h3><a name="a2._Unpack_SignServer"></a>2. Unpack SignServer</h3>
                    
<p>
Download and unzip the
<a class="externalLink" href="https://sourceforge.net/projects/signserver/files/signserver/">latest
SignServer Community Edition release</a> archive from SourceForge.
                    </p>
                    
<p>
Note that SignServer is available in different distributions:
                    </p>
                    
<ul>
                        
<li><b>signserver-4.x.y-bin.zip</b>:<br />
                        The binary distribution (recommended)</li>
                        
<li><b>signserver-4.x.y.zip:</b><br />
                        The mixed distribution. Contains the sources as well as all required libraries. This requires you to build SignServer before deploying.</li>
                        
<li><b>signserver-4.x.y-src.tar.gz:</b><br />
                        The source-only tarball distribution. This one can not be deployed without first gathering all the dependencies and then building it. If you choose this one you are on your own.</li>
                    </ul>

                    
<p>
Make sure to compare the checksums as provided on <a class="externalLink" href="https://www.signserver.org/download.html">https://signserver.org/download.html</a> or from a by PrimeKey provided download site.
                    </p>                    
                    
<div class="source"><pre class="prettyprint">
sha256sum signserver-4.x.y-bin.zip
unzip signserver-4.x.y-bin.zip</pre></div>
                    
                    
<p>
Alternatively, you can checkout the latest unstable version from version the Subversion (SVN)
<a class="externalLink" href="https://svn.cesecore.eu/svn/signserver/trunk/">repository</a>.
Note that as with the mixed distribution this one needs to be built before deploying.
                    </p>
                </div>
                
                
<div class="section">
<h3><a name="a3._Build_SignServer"></a>3. Build SignServer</h3>
                    
<p>
Skip this step if you downloaded the binary distribution (recommended).
                    </p>
                    
<p>
If you instead downloaded the mixed disribution or checked out from SVN and want to build SignServer your self before copying it to the target server then you need to peform the following steps on your build machine.
                    </p>
                    
<p>
Note: Before running any of the Maven (mvn) commands you must make sure you have a secure Maven installation that does not contact the Central repository over insecure HTTP.
You should make sure that the URL for the Central repository is specified with HTTTPS (and/or to use an internal repository).<br />
See sample-maven-settings-community.xml for an example on how one can override the default Maven settings in ~/.m2/settings.xml.
                    </p>
                    
<div class="source"><pre class="prettyprint">mvn help:effective-settings</pre></div>
                    
                    
<p>
Then to build the sources run:
                    </p>
                    
<div class="source"><pre class="prettyprint">mvn install -DskipTests</pre></div>
                </div>

                
<div class="section">
<h3><a name="a4._Set_environment_variables"></a>4. Set environment variables</h3>
                    
<div class="section">
<h4><a name="APPSRV_HOME"></a>APPSRV_HOME</h4>
                        
<p>
Set APPSRV_HOME to point to your application server installation (<tt>/opt/jboss</tt> could be a symbolic link).
                        </p>
                        
<div class="source"><pre class="prettyprint">export APPSRV_HOME=/opt/jboss</pre></div>
                        
                        
<p>
This variable is used when deploying to the application server and could for instance be set in your .bashrc or similar file or provided everytime the deploy command is executed.
                        </p>

                    </div>
<div class="section">
<h4><a name="SIGNSERVER_NODEID"></a>SIGNSERVER_NODEID</h4>
                        
<p>
Set SIGNSERVER_NODEID to an unique ID for the server.
                        </p>
                        
<div class="source"><pre class="prettyprint">export SIGNSERVER_NODEID=node1</pre></div>
                        
                        
<p>
This variable should be available to the application server so it might have to be set in /etc/environment or similar. It is normally not required to have it set but without it there will be warnings printed in the log.
                        </p>

                </div></div>

                
<div class="section">
<h3><a name="a5._Setup_database"></a>5. Setup database</h3>
                    
<p>
Skip this section and instead follow the instructions in 
<a href="misc.html#SignServer_without_Database">SignServer without Database</a> if
you decide to run SignServer without a database management system.
                    </p>
                    
<p>
If you are using a database you will need to get a JDBC driver from the database
vendor.
                    </p>
                    
<div class="section">
<h4><a name="Database_account"></a>Database account</h4>
                    
<p>
Create a database and database user for SignServer. Please, refer to the database vendor's documentation for how to do that.
                    </p>
                    
                    </div>
<div class="section">
<h4><a name="Table_creation_and_indexes"></a>Table creation and indexes</h4>
                    
<p>
The application server will try to create tables during startup of SignServer but if the database user does not have table create permissions the tables must be created manually.
See <tt>doc/sql-scripts/create-tables-signserver-*.sql</tt> for the database schemas for different databases.
                    </p>
                    
<p>
In order to improve performance the appropriate database indices should also be applied. This is extra important for the AuditRecordData table which otherwise will make SignServer slower and slower to start. See <tt>doc/sql-scripts/create-index-signserver.sql</tt>.
                    </p>
                    </div>
<div class="section">
<h4><a name="MariaDB_binlog_format_configuration"></a>MariaDB binlog format configuration</h4>
                        
<p>
For MariaDB you will have to set binlog_format to &quot;row&quot;, for instance in /etc/mysql/my.cnf:
                        </p>
                        
<div class="source"><pre class="prettyprint">binlog_format=row</pre></div>

                    </div>
<div class="section">
<h4><a name="Configure_database_driver_for_GlassFishPayara"></a>Configure database driver for GlassFish/Payara</h4>
                        
<p>
Copy the driver for your database to the application server lib folder.
                        </p>    

                    </div>
<div class="section">
<h4><a name="Configure_database_driver_for_JBoss_AS_7_JBoss_EAP_6_or_WildFly"></a>Configure database driver for JBoss AS 7, JBoss EAP 6 or WildFly</h4>

<p>
In JBoss 7/EAP6/WildFly it is not enough to just drop the JAR archive with a database JDBC driver into the deployments directory. Instead you will have to perform the following steps (for MySQL or MariaDB):
</p>

<ol style="list-style-type: decimal">

<li>Create the necessary directories (relative to JBoss 7 base directory):
<br />
On JBoss 7.1.1 or EAP 6.0:

<div>
<pre>
mkdir -p modules/com/mysql/main/
</pre></div>
On JBoss 7.2 or EAP 6.1:

<div>
<pre>
mkdir -p modules/system/layers/base/com/mysql/main/
</pre></div>
Or for MariaDB, mariadb-java-client-1.1.2.jar:

<div>
<pre>
mkdir -p modules/org/mariadb/main/
</pre></div>
On JBoss 7.2, EAP 6.1 (or later) or WildFly:

<div>
<pre>
mkdir -p modules/system/layers/base/org/mariadb/main/
</pre></div>
</li>

<li>Place the mysql.jar or mariadb.jar file in the directory you just created.</li>

<li>Create, in the created directory, the JDBC module configuration file module.xml with the following contents (replace mysql.jar with the full name of your jar file for example mysql-connector-java-5.1.18-bin.jar):

<div>
<pre>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;module xmlns=&quot;urn:jboss:module:1.0&quot; name=&quot;com.mysql&quot;&gt;
  &lt;resources&gt;
    &lt;resource-root path=&quot;mysql.jar&quot;/&gt;
  &lt;/resources&gt;
  &lt;dependencies&gt;
    &lt;module name=&quot;javax.api&quot;/&gt;
    &lt;module name=&quot;javax.transaction.api&quot;/&gt;
  &lt;/dependencies&gt;
&lt;/module&gt;
<!-- This is the original of above XML text.
<?xml version="1.0" encoding="UTF-8"?>
<module xmlns="urn:jboss:module:1.0" name="com.mysql">
  <resources>
    <resource-root path="mysql.jar"/>
  </resources>
  <dependencies>
    <module name="javax.api"/>
    <module name="javax.transaction.api"/>
  </dependencies>
</module> --></pre></div>
Or for MariaDB, mariadb-java-client-1.1.2.jar:

<div>
<pre>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;module xmlns=&quot;urn:jboss:module:1.0&quot; name=&quot;org.mariadb&quot;&gt;
  &lt;resources&gt;
    &lt;resource-root path=&quot;mariadb-java-client-1.1.2.jar&quot;/&gt;
  &lt;/resources&gt;
  &lt;dependencies&gt;
    &lt;module name=&quot;javax.api&quot;/&gt;
    &lt;module name=&quot;javax.transaction.api&quot;/&gt;
  &lt;/dependencies&gt;
&lt;/module&gt;
</pre></div>

</li>

<li>Register the driver by running the following two commands in the JBoss 7 CLI administration tool:

<div>
<pre>
/subsystem=datasources/jdbc-driver=com.mysql.jdbc.Driver:add(driver-name=com.mysql.jdbc.Driver,driver-module-name=com.mysql,driver-xa-datasource-class-name=com.mysql.jdbc.jdbc.jdbc2.optional.MysqlXADataSource)
:reload
</pre></div>
Or for MariaDB, mariadb-java-client-1.1.2.jar:

<div>
<pre>
/subsystem=datasources/jdbc-driver=org.mariadb.jdbc.Driver:add(driver-name=org.mariadb.jdbc.Driver,driver-module-name=org.mariadb,driver-xa-datasource-class-name=org.mariadb.jdbc.MySQLDataSource)
:reload
</pre></div>
</li>
</ol>


<p>For PostgreSQL you would use the following values instead:</p>

<div>
<pre>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;module xmlns=&quot;urn:jboss:module:1.0&quot; name=&quot;org.postgresql&quot;&gt;
  &lt;resources&gt;
    &lt;resource-root path=&quot;postgresql-9.1-903.jdbc4.jar&quot;/&gt;
  &lt;/resources&gt;
  &lt;dependencies&gt;
    &lt;module name=&quot;javax.api&quot;/&gt;
    &lt;module name=&quot;javax.transaction.api&quot;/&gt;
  &lt;/dependencies&gt;
&lt;/module&gt;
</pre></div>

<div>
<pre>
/subsystem=datasources/jdbc-driver=org.postgresql.Driver:add(driver-name=org.postgresql.Driver,driver-module-name=org.postgresql,driver-xa-datasource-class-name=org.postgresql.xa.PGXADataSource)
:reload
</pre></div>
    
                </div>
<div class="section">
<h4><a name="Configure_data_source_for_GlassFishPayara"></a>Configure data source for GlassFish/Payara</h4>
                    
<p>
For GlassFish/Payara also configure a connection pool and JNDI resource:
                    </p>
                    
<ol style="list-style-type: decimal">
                        
<li>Go to the Admin Console: http://localhost:4848</li>
                        
<li>Click on Resources -&gt; JDBC -&gt; Connection Pools</li>
                        
<li>Add a new Pool. For instance: Name: MySQLPool</li>
                        
<li>
                            Fill in:<br />
                            databaseName: signserver<br />
                            password: signserver<br />
                            portNumber 3306<br />
                            serverName: localhost<br />
                            user: signserver
                        </li>
                        
<li>Click Ping to test</li>
                        
<li>Click on Resources -&gt; JDBC -&gt; JDBC Resources</li>
                        
<li>
                             Add new:<br />
                             JNDI Name: jdbc/SignServerDS<br />
                             Pool Name: MySQLPool
                         </li>
                    </ol>

                    
                    </div>
<div class="section">
<h4><a name="Configure_data_source_for_JBoss_AS_7.1"></a>Configure data source for JBoss AS 7.1</h4>
                        
<p>
The examples are for installing a MariaDB datasource using the jboss-cli with the driver installed as described above. </p>

<p>A normal datasource (Note: no --enabled=true for JBoss AS 7.1):</p>
<!-- TODO: Add example for MySQL -->

<div class="source"><pre class="prettyprint">data-source add --name=signserverds --driver-name=&quot;org.mariadb.jdbc.Driver&quot; --connection-url=&quot;jdbc:mysql://127.0.0.1:3306/signserver&quot; --jndi-name=&quot;java:/SignServerDS&quot; --use-ccm=true --driver-class=&quot;org.mariadb.jdbc.Driver&quot; --user-name=&quot;signserver&quot; --password=&quot;signserver&quot; --validate-on-match=true --background-validation=false --prepared-statements-cache-size=50 --share-prepared-statements=true --min-pool-size=5 --max-pool-size=150 --pool-prefill=true --transaction-isolation=TRANSACTION_READ_COMMITTED --check-valid-connection-sql=&quot;select 1;&quot;</pre></div>
                        
<p>
Then restart the application server.
                        </p>

                    
                    </div>
<div class="section">
<h4><a name="Configure_data_source_for_JBoss_EAP_6_or_WildFly"></a>Configure data source for JBoss EAP 6 or WildFly</h4>
                        
<p>
The examples are for installing a MariaDB datasource using the jboss-cli with the driver installed as described above. </p>

<p>A normal datasource (Note: --enabled=true for JBoss EAP 6.x):</p>
<!-- TODO: Add example for MySQL -->

<div class="source"><pre class="prettyprint">data-source add --name=signserverds --driver-name=&quot;org.mariadb.jdbc.Driver&quot; --connection-url=&quot;jdbc:mysql://127.0.0.1:3306/signserver&quot; --jndi-name=&quot;java:/SignServerDS&quot; --use-ccm=true --driver-class=&quot;org.mariadb.jdbc.Driver&quot; --user-name=&quot;signserver&quot; --password=&quot;signserver&quot; --validate-on-match=true --background-validation=false --prepared-statements-cache-size=50 --share-prepared-statements=true --min-pool-size=5 --max-pool-size=150 --pool-prefill=true --transaction-isolation=TRANSACTION_READ_COMMITTED --check-valid-connection-sql=&quot;select 1;&quot; --enabled=true</pre></div>
                        
<p>
Then restart the application server.
                        </p>

                    
                </div></div>

                
<div class="section">
<h3><a name="a6._Configure_web_server_keystores"></a>6. Configure web server keystores</h3>
                    
<div class="section">
<h4><a name="GlassFishPayara_SSL_configuration"></a>GlassFish/Payara SSL configuration</h4>
                        
<p>
For GlassFish/Payara enable client authentication for http-listener-2 and manually
update the keystores with the right certificates.
                        </p>

                    </div>
<div class="section">
<h4><a name="JBoss_7EAP_6_SSL_configuration"></a>JBoss 7/EAP 6 SSL configuration</h4>
                        
<p>
Copy the keystore file as JBOSS7_HOME/standalone/configuration/keystore/keystore.jks and the trust store as
                          JBOSS7_HOME/standalone/configuration/keystore/truststore.jks.
                        </p>
                        
<p>
Configure interfaces using the approproate bind address (i.e. 0.0.0.0 or 127.0.0.1).
                        </p>
                        
<div class="source"><pre class="prettyprint">/interfaces=/interface=http:add(inet-address=&quot;0.0.0.0&quot;)
/interfaces=/interface=httpspub:add(inet-address=&quot;0.0.0.0&quot;)
/interfaces=/interface=httpspriv:add(inet-address=&quot;0.0.0.0&quot;)</pre></div>
                        
<p>
Set-up the private port which requires client certificate. 
Use appropriate values for key-alias (hostname), password (keystore password), ca-certificate-password (truststore password),
and supported protocols.
                        </p>
                        
<div class="source"><pre class="prettyprint">
/socket-binding-group=standard-sockets/socket-binding=httpspriv:add(port=&quot;8443&quot;,interface=&quot;httpspriv&quot;)
/subsystem=web/connector=httpspriv:add(protocol=HTTP/1.1, scheme=https, socket-binding=httpspriv, secure=true)
/subsystem=web/connector=httpspriv/ssl=configuration:add(key-alias=&quot;localhost&quot;)
/subsystem=web/connector=httpspriv/ssl=configuration:write-attribute(name=password, value=&quot;serverpwd&quot;)
/subsystem=web/connector=httpspriv/ssl=configuration:write-attribute(name=certificate-key-file, value=&quot;${jboss.server.config.dir}/keystore/keystore.jks&quot;)
/subsystem=web/connector=httpspriv/ssl=configuration:write-attribute(name=verify-client, value=true)
/subsystem=web/connector=httpspriv/ssl=configuration:write-attribute(name=ca-certificate-password, value=&quot;changeit&quot;)
/subsystem=web/connector=httpspriv/ssl=configuration:write-attribute(name=ca-certificate-file, value=&quot;${jboss.server.config.dir}/keystore/truststore.jks&quot;)
/subsystem=web/connector=httpspriv/ssl=configuration:write-attribute(name=protocol,value=&quot;TLSv1,TLSv1.1,TLSv1.2&quot;)</pre></div>
                        
<p>
Set-up the public SSL port which doesn't require the client certificate.
Use appropriate values for key-alias (hostname), password (keystore password),
and supported protocols.
                        </p>
                        
<div class="source"><pre class="prettyprint">
/socket-binding-group=standard-sockets/socket-binding=httpspub:add(port=&quot;8442&quot;,interface=&quot;httpspub&quot;)
/subsystem=web/connector=httpspub:add(protocol=HTTP/1.1, scheme=https, socket-binding=httpspub, secure=true)
/subsystem=web/connector=httpspub/ssl=configuration:add(key-alias=&quot;localhost&quot;)
/subsystem=web/connector=httpspub/ssl=configuration:write-attribute(name=password, value=&quot;serverpwd&quot;)
/subsystem=web/connector=httpspub/ssl=configuration:write-attribute(name=certificate-key-file, value=&quot;${jboss.server.config.dir}/keystore/keystore.jks&quot;)
/subsystem=web/connector=httpspub/ssl=configuration:write-attribute(name=protocol,value=&quot;TLSv1,TLSv1.1,TLSv1.2&quot;)</pre></div>
                        
<p>
If the server is not so fast, we have to wait a little before we can reload, otherwise it will be bad
                        </p>
                        
<div class="source"><pre class="prettyprint">:reload</pre></div>


                </div>
<div class="section">
<h4><a name="WildFly_9_SSL_configuration"></a>WildFly 9 SSL configuration</h4>
                        
<p>
Copy the keystore file as WILDFLY_HOME/standalone/configuration/keystore/keystore.jks and the trust store as
                          WILDFLY_HOME/standalone/configuration/keystore/truststore.jks.
                        </p>
                        
<p>
Configure interfaces using the approproate bind address (i.e. 0.0.0.0 or 127.0.0.1).
                        </p>
                        
<div class="source"><pre class="prettyprint">
/interface=http:add(inet-address=&quot;0.0.0.0&quot;)
/interface=httpspub:add(inet-address=&quot;0.0.0.0&quot;)
/interface=httpspriv:add(inet-address=&quot;0.0.0.0&quot;)</pre></div>

                        
<p>
Secure the CLI by removing the http-remoting-connector from using the http port and instead use a separate port 4447.
                        </p>
                        
<div class="source"><pre class="prettyprint">
/subsystem=remoting/http-connector=http-remoting-connector:remove
/subsystem=remoting/http-connector=http-remoting-connector:add(connector-ref=&quot;remoting&quot;,security-realm=&quot;ApplicationRealm&quot;)
/socket-binding-group=standard-sockets/socket-binding=remoting:add(port=&quot;4447&quot;)
/subsystem=undertow/server=default-server/http-listener=remoting:add(socket-binding=remoting)
:reload</pre></div>

                        
<p>
Set-up the private port which requires client certificate. 
Use appropriate values for key-alias (hostname), password (keystore password), ca-certificate-password (truststore password),
and supported protocols.
                        </p>
                        
<div class="source"><pre class="prettyprint">
/socket-binding-group=standard-sockets/socket-binding=httpspriv:add(port=&quot;8443&quot;,interface=&quot;httpspriv&quot;)
/core-service=management/security-realm=SSLRealm:add()
/core-service=management/security-realm=SSLRealm/server-identity=ssl:add(keystore-path=&quot;keystore/keystore.jks&quot;, keystore-relative-to=&quot;jboss.server.config.dir&quot;, keystore-password=&quot;serverpwd&quot;, alias=&quot;localhost&quot;)
/core-service=management/security-realm=SSLRealm/authentication=truststore:add(keystore-path=&quot;keystore/truststore.jks&quot;, keystore-relative-to=&quot;jboss.server.config.dir&quot;, keystore-password=&quot;changeit&quot;)
/subsystem=undertow/server=default-server/https-listener=httpspriv:add(socket-binding=&quot;httpspriv&quot;, security-realm=&quot;SSLRealm&quot;, verify-client=REQUIRED)</pre></div>
                        
<p>
Set-up the public SSL port which doesn't require the client certificate.
                        </p>
                        
<div class="source"><pre class="prettyprint">
/socket-binding-group=standard-sockets/socket-binding=httpspub:add(port=&quot;8442&quot;,interface=&quot;httpspub&quot;)
/subsystem=undertow/server=default-server/https-listener=httpspub:add(socket-binding=&quot;httpspub&quot;, security-realm=&quot;SSLRealm&quot;)</pre></div>
                        
<div class="source"><pre class="prettyprint">reload</pre></div>
                </div></div>

                
<div class="section">
<h3><a name="a7._Configure_application_server"></a>7. Configure application server</h3>
                    
<div class="section">
<h4><a name="Fix_web_service_problem_in_JBoss_AS_7EAP_6WildFly"></a>Fix web service problem in JBoss AS 7/EAP 6/WildFly</h4>
                        
<p>
Configure WSDL web-host rewriting to use the request host. Needed for webservices to work correctly when requiring client certificate.
                        </p>
                        
<div class="source"><pre class="prettyprint">
/subsystem=webservices:write-attribute(name=wsdl-host, value=jbossws.undefined.host)
/subsystem=webservices:write-attribute(name=modify-wsdl-address, value=true)</pre></div>
                        
<p>
If the server is not so fast, we have to wait a little before we can reload, otherwise it will be bad
                        </p>
                        
<div class="source"><pre class="prettyprint">:reload</pre></div>

                    </div>
<div class="section">
<h4><a name="JBoss_7_and_Oracle_JDK_BouncyCastle_issues"></a>JBoss 7 and Oracle JDK BouncyCastle issues</h4>
                        
<p>
When using Oracle JDK and JBoss 7 you need to install BC jars as a module in JBoss 7. See <a class="externalLink" href="https://issues.jboss.org/browse/JBAS-7882">JBAS-7882</a>.
                        </p>
                        
<p>
How to install modules are described in <a class="externalLink" href="https://docs.jboss.org/author/display/MODULES/Defining+a+module">docs.jboss.org/author/display/MODULES/Defining+a+module</a>.
                        </p>

                    </div>
<div class="section">
<h4><a name="Fix_XML_Security_library_issue_1_in_JBoss_7"></a>Fix XML Security library issue 1 in JBoss 7</h4>
                                                
<p>
        JBoss 7 bundles version 1.5.1 of the XML Security library. The library bundled with SignServer is not
        properly overriding the JBoss-bundled version.
        To work around this issue copy the JAR file from SignServer into JBoss' modules directory and modifiy the descriptor to use the new version.
                                                </p>
                                                
<p>
        On Linux/Unix systems the following command can be used:
                                                </p>
                                                
<div class="source"><pre class="prettyprint">cp lib/ext/xmlsec-1.5.8.jar $APPSRV_HOME/modules/org/apache/santuario/xmlsec/main/</pre></div>
                                                
<p>
        On Windows systems the following command can be used:
                                                </p>
                                                
<div class="source"><pre class="prettyprint">copy lib\ext\xmlsec-1.5.8.jar %APPSRV_HOME%\modules\org\apache\santuario\xmlsec\main\</pre></div>
                                                
<p>
        Edit $APPSRV_HOME/modules/org/apache/santuario/xmlsec/main/module.xml to use the correct version:
                                                </p>
                                                
<div class="source"><pre class="prettyprint">&lt;resource-root path=&quot;xmlsec-1.5.8.jar&quot;/&gt;</pre></div>

                    </div>
<div class="section">
<h4><a name="Fix_XML_Security_library_issue_2_in_JBoss_7"></a>Fix XML Security library issue 2 in JBoss 7</h4>
                                                
<p>
        JBoss 7 bundles version 2.7.1 of the Xalan library. The library bundled with SignServer is not
        properly overriding the JBoss-bundled version.
        To work around this issue copy the JAR files from SignServer into JBoss' modules directory and modifiy the descriptor to use the new version.
                                                </p>
                                                
<p>
        On Linux/Unix systems the following command can be used:
                                                </p>
                                                
<div class="source"><pre class="prettyprint">cp lib/ext/xalan-2.7.2.jar lib/ext/serializer-2.7.2.jar $APPSRV_HOME/modules/org/apache/xalan/main/</pre></div>
                                                
<p>
        On Windows systems the following command can be used:
                                                </p>
                                                
<div class="source"><pre class="prettyprint">
copy lib\ext\xalan-2.7.2.jar %APPSRV_HOME%\modules\org\apache\xalan\main\
copy lib\ext\serializer-2.7.2.jar %APPSRV_HOME%\modules\org\apache\xalan\main\</pre></div>
                                                
<p>
        Edit $APPSRV_HOME/modules/org/apache/xalan/main/module.xml to use the correct versions:
                                                </p>
                                                
<div class="source"><pre class="prettyprint">
&lt;resource-root path=&quot;serializer-2.7.2.jar&quot;/&gt;
&lt;resource-root path=&quot;xalan-2.7.2.jar&quot;/&gt;</pre></div>

                    </div>
<div class="section">
<h4><a name="Commons_Collections_Security_issue_in_JBoss_7_and_earlier"></a>Commons Collections Security issue in JBoss 7 and earlier</h4>
                        
<p>
JBoss 7 bundles version 3.2.1 of Commons Collections which has potential security issues. SignServer uses version 3.2.2. Perform similar changes as in the previous section to have JBoss use the 3.2.2 version instead.
                        </p>

                    </div>
<div class="section">
<h4><a name="Fix_Security_issues_in_JBoss_EAP"></a>Fix Security issues in JBoss EAP</h4>
                        
<p>
Make sure to apply the relevant security patches from Red Hat. Pay special attention to the above mentioned XML Security and Commons Collections libraries etc.
                        </p>

                    </div>
<div class="section">
<h4><a name="Install_Hibernate_in_GlassFish_3"></a>Install Hibernate in GlassFish 3</h4>
                        
<p>
If you are using GlassFish 3 and run with a database you will have to install Hibernate. 
Run pkg install in the GlassFish folder:
                        </p>
                        
<div class="source"><pre class="prettyprint">./bin/pkg install hibernate</pre></div>
                </div></div>


                
<div class="section">
<h3><a name="a8._Configure_deployment"></a>8. Configure deployment</h3>
                    
<p>
Copy conf/signserver_deploy.properties.sample to conf/signserver_deploy.properties and open
it for editing in your favorite text editor.
                    </p>
                    
<div class="source"><pre class="prettyprint">cp conf/signserver_deploy.properties.sample conf/signserver_deploy.properties</pre></div>    
                        
                    
<div class="section">
<h4><a name="Database_configuration"></a>Database configuration</h4>
                        
<p>
Select database management system
                        </p>
                        
<div class="source"><pre class="prettyprint">database.name=mysql</pre></div>

                    
<p>
See <a href="misc.html#Signed20log">Signed log</a> for how to configure for signed audit logs in the database.
                    </p>
                </div></div>

                
<div class="section">
<h3><a name="a9._Deploy_SignServer"></a>9. Deploy SignServer</h3>
                    
<p>
Run &quot;bin/ant deploy&quot; to build the configuration and deploy it to the selected application
server.
                    </p>
                    
<div class="source"><pre class="prettyprint">bin/ant deploy</pre></div>
                    
<p>
Start the application server and verify that SignServer was deployed.
                    </p>
                </div>

                
<div class="section">
<h3><a name="a9._Accessing_SignServer"></a>9. Accessing SignServer</h3>
                    
<p>
After startup a few different user interfaces are available.	
                    </p>
                    
<div class="section">
<h4><a name="Command_Line_Interface"></a>Command Line Interface</h4>
                    
<div class="source"><pre class="prettyprint">
bin/signserver getstatus brief all
Current version of server is : SignServer EE 4.0.0</pre></div>

                    </div>
<div class="section">
<h4><a name="Graphical_User_Interface"></a>Graphical User Interface</h4>
                    
<div class="source"><pre class="prettyprint">bin/signserver-gui</pre></div>

                    </div>
<div class="section">
<h4><a name="Web_Interface"></a>Web Interface</h4>
                    
<p>
Point your web browser to <a class="externalLink" href="http://localhost:8080/signserver">http://localhost:8080/signserver</a> for demo web pages and local documentation.
                    </p>
                </div></div>
            </div>

            
<div class="section">
<h2><a name="Signer_setup"></a>Signer setup</h2>
                
<p>
After server installation the different signers can be setup using the
SignServer CLI.
                </p>
                
<div class="section">
<h3><a name="Loading_signers"></a>Loading signers</h3>
                    
<p>
Signers (and other workers) can be loaded by setting properties using &quot;setproperty&quot; or &quot;setproperties&quot; etc.
                    </p>
                    
<div class="section">
<h4><a name="setproperties"></a>setproperties</h4>
                        
<p>
The &quot;setproperties&quot; command loads all the properties from a property file that
can define one or many signers. The code for the signers needs to be deployed
to the application server together with SignServer either by setting
includemodulesinbuild=true to include all modules or by setting individual
module.MODULENAME.enabled=true properties in signserver_deploy.properties.
                        </p>
                        
<div class="source"><pre class="prettyprint">bin/signserver setproperties doc/sample-configs/CONFIGURATION.PROPERTIES</pre></div>

                    
<p>
After adding or changing a property for a worker (by
any of the &quot;setproperty&quot; or &quot;setproperties&quot; commands) the configuration needs be
applied by issuing the reload command with the ID of the worker.
                    </p>
                    
<div class="source"><pre class="prettyprint">bin/signserver reload 4711</pre></div>
                </div></div>

                
<div class="section">
<h3><a name="Quick_start_demo_setup"></a>Quick start demo setup</h3>
                    
<p>
This is a quick start guide to quickly get you setup with a crypto token and a set of workers/signers for testing and demonstration purposes.
                    </p>
                    
<div class="section">
<h4><a name="Setup_a_sample_crypto_token"></a>Setup a sample crypto token</h4>

<p>Set up a crypto token called CryptoTokenP12 which uses a keystore-based token:</p>

<div class="source"><pre class="prettyprint">$ bin/signserver setproperties doc/sample-configs/keystore-crypto.properties</pre></div>
                        
<p>
Activate the configuration using the assigned worker ID that was printed (for instance 1):
                        </p>

<div class="source"><pre class="prettyprint">$ bin/signserver reload 1</pre></div>

                    </div>
<div class="section">
<h4><a name="Add_sample_workers"></a>Add sample workers</h4>
                        
<p>
Workers can then be set up using the setproperties followed by the reload command. Sample configurations
are available in doc/sample-configs which by default uses the sample crypto token:
                        </p>

<div class="source"><pre class="prettyprint">$ bin/signserver setproperties doc/sample-configs/CONFIGURATION.properties</pre></div>
                        
<p>
Activate the configuration using the assigned worker ID that was printed (for instance 2):
                        </p>

<div class="source"><pre class="prettyprint">$ bin/signserver reload 2</pre></div>

<p>See the following section for some example for specific workers.</p>


                </div></div>

                
<div class="section">
<h3><a name="Quick_start_demo_Timestamp_signer"></a>Quick start demo Timestamp signer</h3>
                    
<p>
This is a quick start guide to quickly get you setup with a demo Time Stamp service (TSA according to RFC3161). It will let you quickly get a feeling how the structure of the SignServer works, so you can move on to more advanced features described in the manual.
                    </p>

                    
<ol style="list-style-type: decimal">
                        
<li>
Make sure the tsa module is built in by setting module.tsa.enabled=true and
module.tsa.include=true in signserver_deploy.properties before building and
deploying SignServer. Alternativly, set includemodulesinbuild=true to have all
modules built in.
                        </li>
                        
<li>
Setup the keystore crypto token (if not already done) and activate it with its ID:<br />

<div class="source"><pre class="prettyprint">$ bin/signserver setproperties doc/sample-configs/keystore-crypto.properties</pre></div><br />
Update the crypto token's KEYSTOREPATH property to point to a PKCS#12 keystore containing keys and<br />
certificate suitable for timestamp signing (the sample keystore in res/test/dss10/dss10_tssigner1.p12 can be used).<br />
Update the keystore password and set the crypto token's default key.<br />

<div class="source"><pre class="prettyprint">$ bin/signserver setproperty 1 KEYSTOREPATH $SIGNSERVER_HOME/res/test/dss10/dss10_tssigner1.p12
$ bin/signserver setproperty 1 KEYSTOREPASSWORD foo123
$ bin/signserver setproperty 1 DEFAULTKEY &quot;TS Signer 1&quot;
$ bin/signserver reload 1</pre></div>
                        </li>
                        
<li>
Load the Timestamp demo configuration and notice the generated worker ID (in this
example 2):<br />

<div class="source"><pre class="prettyprint">$ bin/signserver setproperties doc/sample-configs/timestamp.properties</pre></div>
                        </li>
                        
<li>
Activate the configuration with:<br />

<div class="source"><pre class="prettyprint">$ bin/signserver reload 2</pre></div>
                        </li>
                        
<li>
You can check the status and configuration with:<br />

<div class="source"><pre class="prettyprint">$ bin/signserver getstatus complete all</pre></div>
                        </li>
                        
<li>
Run the test client to see that everything is up:<br />

<div class="source"><pre class="prettyprint">$ bin/signclient timestamp http://localhost:8080/signserver/process?workerName=TimeStampSigner</pre></div>
<br />The message &quot;TimeStampRequest validated&quot; should appear once a second. Also
check JBOSS_HOME/server/default/log/server.log or
GLASSFISH_HOME/domains/domain1/logs/server.log that successful messages appear.
                        </li>
                    </ol>
                </div>

                
<div class="section">
<h3><a name="Quick_start_demo_PDF_signer"></a>Quick start demo PDF signer</h3>
                    
<p>
To install the PDF signer you can issue the following commands (either instead of the TSA or in addition to the TSA).
                    </p>
                    
<ol style="list-style-type: decimal">
                        
<li>
Make sure the pdfsigner module is built in by setting module.pdfsigner.enabled=true and
module.pdfsigner.include=true in signserver_deploy.properties before building and
deploying SignServer. Alternativly, set includemodulesinbuild=true to have all
modules built in.
                        </li>
                        
<li>
Setup the keystore crypto token (if not already done) and activate it with its ID:<br />

<div class="source"><pre class="prettyprint">$ bin/signserver setproperties doc/sample-configs/keystore-crypto.properties</pre></div><br />
Update the crypto token's KEYSTOREPATH property to point to a PKCS#12 keystore containing keys and<br />
certificate suitable for document signing (the sample keystore in res/test/dss10/dss10_signer1.p12 can be used).<br />
Update the keystore password and set the crypto token's default key.<br />

<div class="source"><pre class="prettyprint">$ bin/signserver setproperty 1 KEYSTOREPATH $SIGNSERVER_HOME/res/test/dss10/dss10_signer1.p12
$ bin/signserver setproperty 1 KEYSTOREPASSWORD foo123
$ bin/signserver setproperty 1 DEFAULTKEY &quot;Signer 1&quot;
$ bin/signserver reload 1</pre></div>
                        </li>
                        
<li>
Load the PDF signer demo configuration and notice the generated worker ID (in this
example 3):<br />

<div class="source"><pre class="prettyprint">$ bin/signserver setproperties doc/sample-configs/pdfsigner.properties</pre></div>
                        </li>
                        
<li>
Activate the configuration with:<br />

<div class="source"><pre class="prettyprint">$ bin/signserver reload 3</pre></div>
                        </li>
                        
<li>
You can check the status and configuration with:<br />

<div class="source"><pre class="prettyprint">$ bin/signserver getstatus complete all</pre></div>
                        </li>
</ol>

<p>
You can now access the URL <a class="externalLink" href="http://localhost:8080/signserver/demo/pdfsign.jsp">http://localhost:8080/signserver/demo/pdfsign.jsp</a> with your web browser to get PDF documents signed.
</p>
                </div>

                
<div class="section">
<h3><a name="Quick_start_demo_XML_validator"></a>Quick start demo XML validator</h3>
                    
<p>
An XML validator validates the signature of an XML document. It uses a
certificate validation service worker for validating the certificate so
that worker has to be configured first.
                    </p>
                    
<p>
To install a certificate validation service worker issue the following commands:
                    </p>
                    
<ol style="list-style-type: decimal">
                        
<li>
Load the configuration and notice the worker ID (in this example: 6):<br />

<div class="source"><pre class="prettyprint">$ bin/signserver setproperties doc/sample-configs/validator_dummy.properties</pre></div>
                        </li>
                        
<li>
Activate the configuration with:<br />

<div class="source"><pre class="prettyprint">$ bin/signserver reload 6</pre></div>
                        </li>
                        
<li>
The status of the Worker can now be viewed with:<br />

<div class="source"><pre class="prettyprint">$ bin/signserver getstatus complete CertValidationWorker</pre></div>
                        </li>
                    </ol>
                    
<p>
Then to install the XML validator you can issue the following commands:
                    </p>
                    
<ol style="list-style-type: decimal">
                        
<li>
Make sure the xmlvalidator module is built in by setting module.xmlvalidator.enabled=true and
module.xmlvalidator.include=true in signserver_deploy.properties before building and
deploying SignServer. Alternativly, set includemodulesinbuild=true to have all
modules built in.
                        </li>
                        
<li>
Load the XML validator demo configuration and notice the generated worker ID (in this
example 7):
$ bin/signserver setproperties doc/sample-configs/xmlvalidator.properties
                        </li>
                    
<li>
Verify the configuration with (notice that VALIDATIONSERVICEWORKER is set to &quot;CertValidationWorker&quot;):<br />

<div class="source"><pre class="prettyprint">$ bin/signserver getconfig 7</pre></div>
                    </li>
                    
<li>
Activate the configuration with:<br />

<div class="source"><pre class="prettyprint">$ bin/signserver reload 7</pre></div>
                    </li>
                    
<li>
The status of the Validator can now be viewed with:<br />

<div class="source"><pre class="prettyprint">$ bin/signserver getstatus complete DemoXMLValidator</pre></div>
                    </li>
                    </ol>
                    
<p>
Now <a href="integration.html">the SignServer APIs</a> can be used to request XML documents to be validated by the DemoXMLValidator worker.
                    </p>
                </div>

                
<div class="section">
<h3><a name="Quick_start_demo_MRTD_SOD_signer"></a>Quick start demo MRTD SOD signer</h3>
                    
<p>
The MRTD SOD signer takes as input data group hashes and creates a signed SO(d). This means that the signserver will function
as a Document Signer for ePassports.</p>
                    
<p>
To install the MRTD SOD signer you can issue the following commands:
                    </p>
                    
<ol style="list-style-type: decimal">
                        
<li>
Make sure the mrtdsodsigner module is built in by setting module.mrtdsodsigner.enabled=true and
module.mrtdsodsigner.include=true in signserver_deploy.properties before building and
deploying SignServer. Alternativly, set includemodulesinbuild=true to have all
modules built in.
                        </li>
                        
<li>
Setup the soft crypto token (if not already done) and activate it with its ID:<br />

<div class="source"><pre class="prettyprint">$ bin/signserver setproperties doc/sample-configs/keystore-crypto.properties
$ bin/signserver reload 1</pre></div>
                        </li>
                        
<li>
Load the MRTD SOD signer demo configuration and notice the generated worker ID (in this
example 8):<br />

<div class="source"><pre class="prettyprint">$ bin/signserver setproperties doc/sample-configs/mrtdsodsigner.properties</pre></div>
                        </li>
                        
<li>
Activate the configuration with:<br />

<div class="source"><pre class="prettyprint">$ bin/signserver reload 8</pre></div>
                        </li>
                        
<li>
The status of the signer can now be viewed with:<br />

<div class="source"><pre class="prettyprint">$ bin/signserver getstatus complete mrtdsodsigner</pre></div>
                        </li>
                    </ol>
                    
<p>
Now <a href="integration.html">the SignServer APIs</a> can be used to send MRTD SOD sign requests the MRTDSODSigner.
<br />
Also you can use the HTML page <a class="externalLink" href="http://localhost:8080/signserver/demo/mrtdsodsign.jsp">http://localhost:8080/signserver/demo/mrtdsodsign.jsp</a> to enter requests and get the SOd back.
This HTML form also functions as a sample to show how you can make HTTP requests from the personalisation system to the Document Signer.
                    </p>
                    
<div class="section">
<h4><a name="Production_configuration_with_HSM"></a>Production configuration with HSM</h4>
                        
<p>
To install a production signer using an HSM instead of the CryptoTokenP12, make 
a copy of doc/sample-configs/pkcs11-crypto.properties and configure
the necessary properties for the HSM and apply that file using setproperties and
reload with its worker ID.<br />
(note after changing properties in the file it needs to be loaded again
with setproperties)
                        </p>
                        
<p>
Now when configuring a worker make sure to have the worker property CRYPTOTOKEN=CryptoTokenP11.
                        </p>
                        
<p>
Before starting with an HSM installation you should read the about the
    <a href="plugins.html#PKCS11CryptoToken">PKCS11CryptoToken</a> in the plugins
section of the manual.
                        </p>

<div class="source"><pre class="prettyprint">
bin/signserver setproperties doc/sample-configs/pkcs11-crypto.properties
bin/signserver reload 9
bin/signserver setproperties doc/sample-configs/mrtdsodsigner.properties
bin/signserver setproperty 10 CRYPTOTOKEN CryptoTokenP11
bin/signserver reload 10
bin/signserver activatecryptotoken 9 tokenpin
bin/signserver generatecertreq 9 &quot;C=SE,CN=MRTD SOD Signer&quot; SHA256WithRSA mrtdsodsigner.req
</pre></div>
                        
<p>
Where 9 is the workerId that you got when running the 'setproperties' command for the pkcs11 crypto token.<br />
Tokenpin is the password for the HSM slot configured in the properties file.<br />
This will create a certificate request that you can get signed by your CA. When you have received the response you can import it and the CA certficate.
If you have the returned signer certificate as cert.pem and the CA certificate as cacert.pem, then:
                        </p>

<div class="source"><pre class="prettyprint">
cat cert.pem cacert.pem &gt; certchain.pem
bin/signserver uploadsignercertificate 10 glob cert.pem
bin/signserver uploadsignercertificatechain 10 glob certchain.pem
bin/signserver reload 9
</pre></div>
                        
<p>
Hint: you can use EJBCA to create keys on a PKCS#11 HSM using clientToolBox.<br />
ejbcaClientToolBox.sh PKCS11HSMKeyTool generate /opt/ETcpsdk/lib/linux-x86_64/libcryptoki.so 2048 DSSignKey 5
                        </p>

            </div></div>

            </div>
              
            
<div class="section">
<h2><a name="Upgrade"></a>Upgrade</h2>
                
<p>
See SIGNSERVER_HOME/doc/RELEASE_NOTES.txt and UPGRADE.txt for information about upgrading from an earlier version of SignServer. 
                </p>
            </div>

    

                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                   2006&#x2013;2016.
          All rights reserved.    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
