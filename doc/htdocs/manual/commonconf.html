<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.6 at 2016-09-22 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20160922" />
    <meta http-equiv="Content-Language" content="en" />
    <title>SignServer &#x2013; SignServer Manual</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.5.min.js"></script>

                      </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="../index.html" id="bannerLeft">
                                                                                                <img src="../images/SignServer_pki_by_primekey.png"  alt="SignServer - Open Source server side Digital Signatures"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                  <li id="publishDate">Last Published: 2016-09-22
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 4.0.0
                      </li>
                      
              
      
                                    
    <li class="pull-right">
        <span class="divider">|</span>
                      <a href="https://www.signserver.org" title="SignServer.org">
        SignServer.org</a>
      </li>

  
    <li class="pull-right">
        <span class="divider">|</span>
                      <a href="https://www.ejbca.org/" title="EJBCA">
        EJBCA</a>
      </li>

  
    <li class="pull-right">
                      <a href="https://www.primekey.se/" title="PrimeKey Solutions">
        PrimeKey Solutions</a>
      </li>

                    </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                    <li class="nav-header">Documentation</li>
                              
      <li>
  
                          <a href="../index.html" title="Home">
          <span class="none"></span>
        Home</a>
            </li>
                
      <li>
  
                          <a href="../architecture.html" title="Architecture">
          <span class="none"></span>
        Architecture</a>
            </li>
                
      <li>
  
                          <a href="../manual.html" title="Manual Overview">
          <span class="none"></span>
        Manual Overview</a>
            </li>
                              <li class="nav-header">Manual</li>
                              
      <li>
  
                          <a href="../manual/introduction.html" title="Introduction">
          <span class="none"></span>
        Introduction</a>
            </li>
                
      <li>
  
                          <a href="../manual/installguide.html" title="Installation Guide">
          <span class="none"></span>
        Installation Guide</a>
            </li>
                
      <li>
  
                          <a href="../manual/usageguide.html" title="Usage Guide">
          <span class="none"></span>
        Usage Guide</a>
            </li>
                
      <li>
  
                          <a href="../manual/integration.html" title="Integration">
          <span class="none"></span>
        Integration</a>
            </li>
                
      <li class="active">
  
            <a href="#"><span class="none"></span>Common Configuration</a>
          </li>
                
      <li>
  
                          <a href="../manual/plugins.html" title="Plugins">
          <span class="none"></span>
        Plugins</a>
            </li>
                
      <li>
  
                          <a href="../manual/development.html" title="Development">
          <span class="none"></span>
        Development</a>
            </li>
                
      <li>
  
                          <a href="../manual/misc.html" title="Miscellaneous">
          <span class="none"></span>
        Miscellaneous</a>
            </li>
                              <li class="nav-header">Other</li>
                              
      <li>
  
                          <a href="https://www.signserver.org" title="signserver.org">
          <span class="none"></span>
        signserver.org</a>
            </li>
            </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                                                                                                                         <a href="https://www.primekey.se/technologies/products-overview/ejbca-enterprise/" title="EJBCA - PKI by PrimeKey" class="builtBy">
        <img class="builtBy"  alt="Click the PKI-by-PrimeKey-EJBCA-logo to visit www.ejbca.org" src="../images/ejbca_pki_by_primekey.png"    />
      </a>
                                                                                                          <a href="https://www.primekey.se" title="PrimeKey Solutions" class="builtBy">
        <img class="builtBy"  alt="Click the PrimeKey logo to check out the products and services offered at www.primekey.se" src="../images/logo-PrimeKey.png"    />
      </a>
                      </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <!-- $Id: commonconf.xml 7272 2016-05-06 07:21:18Z netmackan $ -->

    
        
        <h1>Common Configuration</h1>

        
            
            
            
        
<ul>
<li><a href="#Introduction">Introduction</a></li>
<li><a href="#Generic_Worker_Properties">Generic Worker Properties</a></li>
<li><a href="#Setting_Authorization_Type">Setting Authorization Type</a>
<ul>
<li><a href="#SignServer">SignServer</a>
<ul>
<li><a href="#No_authentication">No authentication</a></li>
<li><a href="#Client_certificate_authentication">Client certificate authentication</a></li>
<li><a href="#Usernamepassword-based_authentication">Username/password-based authentication</a></li>
<li><a href="#Username-based_authentication">Username-based authentication</a></li>
<li><a href="#Remote_address_authentication">Remote address authentication</a></li>
<li><a href="#List-based_Address_Authorizer">List-based Address Authorizer</a></li>
<li><a href="#DispatchedAuthorizer">DispatchedAuthorizer</a></li>
<li><a href="#Custom">Custom</a></li></ul></li></ul></li>
<li><a href="#Archiving_Responses">Archiving Responses</a></li>
<li><a href="#Accounter">Accounter</a></li>
<li><a href="#Checking_validity_of_signer_certificates">Checking validity of signer certificates</a></li>
<li><a href="#Limiting_the_number_of_signatures">Limiting the number of signatures</a></li>
<li><a href="#Other_properties">Other properties</a></li></ul>

            
<div class="section">
<h2><a name="Introduction"></a>Introduction</h2>
		
<p>
		Configuring workers are done by setting properties in the worker configuration.
		There is one set of configuration options that are handled by the framework, and that applies to all workers, then there are worker specific properties handled by the worker implementation.
		</p>
		
<p>Properties are usually defined in the module configuration file used to install a module, or configured manually using one of the <i>bin/signserver setproperty</i> variant.</p>
		
            </div>
                
            
<div class="section">
<h2><a name="Generic_Worker_Properties"></a>Generic Worker Properties</h2>
               
<p>
                   <b>NAME</b> = The name of the worker.
               </p>
               
<p>
                   <b>TYPE</b> = The type of the worker. Currently can be one of:
               </p>
               
<ul>
                   
<li>UNKNOWN: Indicating that the type is not yet known/set.</li>
                   
<li>PROCESSABLE: Processable worker that can be invoked to process (for instance sign) data.</li>
                   
<li>TIMED_SERVICE: Worker scheduled to be run at some interval.</li>
                   
<li>SPECIAL: Not a callable or schedulable worker. Reserved for future use.</li>
                   
<li>CRYPTO_WORKER: A special worker only holding a crypto token mainly to be used by other workers.</li>
               </ul>
            </div>
                
            
<div class="section">
<h2><a name="Setting_Authorization_Type"></a>Setting Authorization Type</h2>
                
<div class="section">
<h3><a name="SignServer"></a>SignServer</h3>
                    
<p>
By default (if the property is not set) is client-certificate authentication required for a signature request to be processed. This can be changed with the AUTHTYPE property.
                    </p>
                    
<div class="section">
<h4><a name="No_authentication"></a>No authentication</h4>
                        
<p>
<b>AUTHTYPE</b> =  NOAUTH
                        </p>
                        
<p>
Sets the server to not require any authentication.
                        </p>

                    </div>
<div class="section">
<h4><a name="Client_certificate_authentication"></a>Client certificate authentication</h4>
                        
<p>
<b>AUTHTYPE</b> =  CLIENTCERT
                        </p>
                        
<p>
 (default) requires a certificate of all the clients. The certificates must be 
 in the application server's truststore. Authorized clients is configured
 manually using the CLI interface.
                        </p>

                    </div>
<div class="section">
<h4><a name="Usernamepassword-based_authentication"></a>Username/password-based authentication</h4>
                        
<p>
<b>AUTHTYPE</b> = org.signserver.server.UsernamePasswordAuthorizer
                        </p>
                        
<p>
<b>USER.[NAME]</b> = [PASSWORD]<br />
<b>USER.[NAME]</b> = [HASHED_PASSWORD]:[HASH_ALGORITHM]<br />
<b>USER.[NAME]</b> = [HASHED_PASSWORD]:[HASH_ALGORITHM]:[SALT]<br />
                        </p>
                        
<p>
This authorizer requires a valid username and password. User accounts are
configured by setting properties of the form shown above, where
[NAME] is the username and [PASSWORD] is the clear-text password. In the second
form [HASHED_PASSWORD] should be replaced with the output of the digest algorithm 
specified in [HASH_ALGORITHM]. The third form uses a salt that is appended 
to the password before hashing it.
                        </p>
                        
<p>
If a valid username and
password is not supplied the worker throws an AuthorizationRequiredException
which in case of the HTTP interfaces causes a HTTP Basic Authentication (RFC 2617).
                        </p>

                    </div>
<div class="section">
<h4><a name="Username-based_authentication"></a>Username-based authentication</h4>
                        
<p>
<b>AUTHTYPE</b> = org.signserver.server.UsernameAuthorizer
                        </p>
                        
<p>
Form 1: ACCEPT_ALL_USERNAMES = false (default) and usernames are specified:<br />
<b>ACCEPT_ALL_USERNAMES</b> = false<br />
<b>ACCEPT_USERNAMES</b> = user1;user2;user3
                        </p>
                        
<p>
Form 2, ACCEPT_ALL_USERNAMES = true and no usernames are specified:<br />
<b>ACCEPT_ALL_USERNAMES</b> = true
                        </p>
                        
<p>
An Authorizer that can be used for instance if SignServer sits behind an Apache
front-end which uses HTTP basic authentication. With this Authorizer the username
is logged but the password is not checked as it is assumed to be checked by the
front-end.
                        </p>
                        
<p>
The Authorizer can be configured to either accept all usernames or only accept
those usernames listed in one of its properties.
                        </p>

                    </div>
<div class="section">
<h4><a name="Remote_address_authentication"></a>Remote address authentication</h4>
                        
<p>
<b>AUTHTYPE</b> = org.signserver.server.RemoteAddressAuthorizer
                        </p>
                        
<p>
<b>ALLOW_FROM</b> = Comma separated list of IP addresses to allow requests from.
By default all other addresses are denied access.
                        </p>
                        
<p>
If a worker is invoked directly using an EJB call and no REMOTE_IP is specified
in the RequestContext the IP-address is set to the String &quot;null&quot;. In that case,
to allow requests using EJB calls, null can be added to the list of allowed
addresses.
                        </p>
                        
<p>
<b>Note:</b> When adding &quot;null&quot; to ALLOW_FROM not only locally running clients
like the ClientCLI and AdminGUI is allowed access but also from workers that
invoke the other worker directly using an EJB call. This is for instance the
case for the XMLValidator which delegates the validation of the certificate to
a CertValidator. If the CertValidator had a RemoteAddressAuthorizer allowing
access from &quot;null&quot; then the XMLValidator would be able to use it. To restrict
users from using the CertValidator (indirectly through the XMLValidator) an
Authorizer could be configured for the XMLValidator.
                        </p>
                        
<p>
<b>Logging:</b> This authorizer will add the remote IP address to the log field AUTHORIZED_ADDRESS.
                        </p>

                    </div>
<div class="section">
<h4><a name="List-based_Address_Authorizer"></a>List-based Address Authorizer</h4>
                        
<p>
<b>AUTHTYPE</b> = org.signserver.server.ListBasedAddressAuthorizer
                        </p>
                        
<p>
An authorizer that supports white- and blacklisting direct and forwarded addresses (coming via a proxy).
                        </p>
                        
<p>
<b>WHITELISTED_DIRECT_ADDRESSES</b> = A comma-separated list of IP addresses allowed direct access.
                        </p>
                        
<p>
<b>BLACKLISTED_DIRECT_ADDRESSES</b> = A comma-separated list of IP addresses denied direct access.
                        </p>
                        
<p>
<b>WHITELISTED_FORWARDED_ADDRESSES</b> = A comma-separated list of IP addresses allowed access as a forwarded address.
                        </p>
                        
<p>
<b>BLACKLISTED_FORWARDED_ADDRESSES</b> = A comma-separated list of IP addresses denied access as a forwarded address.
                        </p>
                        
<p>
<b>MAX_FORWARDED_ADDRESSES</b> = Number of IP addresses to inspect in the list of forwarded addresses. (Default: 1).                        
                        </p>
                        
<p>
It is not possible to specify both a whitelist and a black list at the same time for each of direct and forwarded addresses.
One of each list (direct and forwarded) must be specified.
When specifying a whitelist for forwarded addresses, requests without an X-Forwarded-For header will always be denied.
When there are multiple addresses in the X-Forwarded-For header (in the case of using multiple proxies) the number of addresses specified in
MAX_FORWARDED_ADDRESSES counting from the end of the list (or the entire list if it is shorter than this) is considered for white- and blacklisting.
If specified, MAX_FORWARDED_ADDRESSES must have a value &gt;= 1. It is not allowed to set it 0 to disable checking forwarded addresses.
RemoteAddressAuthorizer should be used in this case.
                        </p>
                        
<p>
Examples:
                        </p>
                        
<p>
1. To accept requests from all direct addresses except for 10.0.0.5 and for all forwarded addresses except 13.170.18.12 and 13.170.18.13 use:<br />
BLACKLISTED_DIRECT_ADDRESSES=10.0.0.5<br />
BLACKLISTED_FORWARDED_ADDRESSES=13.170.18.12, 13.170.18.13
                        </p>
                        
<p>
2. To only accept direct requests from 10.0.0.1 and 10.0.0.2 and from the forwarded address 216.34.181.97 use:<br />
WHITELISTED_DIRECT_ADDRESSES=10.0.0.1, 10.0.0.2<br />
WHITELISTED_FORWARDED_ADDRESS=216.34.181.97
                        </p>
                        
<p>
3. To only allow direct access from the proxy servers 10.0.0.1 and 10.0.0.2 but allow them to forward from all address except the to banned addresses 13.170.18.12 and 13.170.18.13 use:<br />
WHITELISTED_DIRECT_ADDRESSES=10.0.0.1, 10.0.0.2<br />
BLACKLISTED_FORWARDED_ADDRESSES=13.170.18.12, 13.170.18.13
                        </p>
                        
<p>
4. To accept direct requests from all addresses except 10.0.0.5 but only forwarded from 216.34.181.97 use:<br />
BLACKLISTED_DIRECT_ADDRESSES=10.0.0.5<br />
WHITELISTED_FORWARDED_ADDRESS=216.34.181.97
                        </p>
                        
<p>
5. To accept direct request from a proxy server 10.0.1.1 allowing forwarding from another proxy 10.0.2.2 in turn proxying the request from the
client with address 192.0.43.10 use:<br />
WHITELISTED_DIRECT_ADDRESSES=10.0.1.1<br />
WHITELISTED_FORWARDED_ADDRESSES=10.0.2.2,192.0.43.10<br />
MAX_FORWARDED_ADDRESSES=2
                        </p>
                        
<p>
6. To blacklist a set of IP addresses, set the MAX_FORWARDED_ADDRESSES value to a value gauranteed to be larger than the number of
proxies you have control over, like in the following example:
BLACKLISTED_FORWARDED_ADDRESSES=10.0.1.1,10.0.2.2,10.0.3.3
MAX_FORWARDED_ADDRESSES=10
                        </p>
                        
<p>
<b>Logging:</b> This authorizer will add the remote IP address to the log field AUTHORIZED_ADDRESS and the proxied address
(if it's available in the request) in the log field AUTHORIZED_FORWARDED_ADDRESS.
                        </p>
  

                    </div>
<div class="section">
<h4><a name="DispatchedAuthorizer"></a>DispatchedAuthorizer</h4>
                        
<p>
<b>AUTHTYPE</b> = org.signserver.server.DispatchedAuthorizer    
                        </p>
                        
<p>
<b>AUTHORIZEALLDISPATCHERS</b> = True, if any Dispatcher should be authorized. (Required) (currently only true is supported)
                        </p>
                        
<p>
Only accepts requests that has gone through a Dispatcher. This Authorizer only checks the present of the DISPATCHER_AUTHORIZED_CLIENT field in the request context to know that the request has passed a Dispatcher.
                        </p>

                    </div>
<div class="section">
<h4><a name="Custom"></a>Custom</h4>
                        
<p>
This authorization functionality doesn't work for all use cases. Then it's possible to create a customized authorizer and specify it's class path as value in the AUTHTYPE property. The Processable will then automatically instantiate and use it. How to develop such a plug-in is explained in the developers section.
                        </p>

                </div></div>
            </div>

            
<div class="section">
<h2><a name="Archiving_Responses"></a>Archiving Responses</h2>
                
<p>
The archiving feature can be used to save all generated responses.    
                </p>
                
<p>
For the OldDatabaseArchiver and Base64DatabaseArchiver, in some extent, the Admin CLI can be used to query the archive. See 
the CLI section for more information.
                </p>
                
<p>
When a request has been process each Archiver is called one at the time to archive 
any results.
                </p>
                
<p>
<b>ARCHIVERS</b>: Used instead of the old ARCHIVE property to enable archiving 
by listing the class names of all the Archivers that should be used. Multiple 
Archivers can be specified separated by a &quot;,&quot; (comma character). Exempel: 
                </p>

<div class="source"><pre class="prettyprint">
ARCHIVERS=org.signserver.server.archive.olddbarchiver.OldDatabaseArchiver,org.signserver.server.archive.otherarchiver.OtherArchiver123
</pre></div>
                
<p>
<b>ARCHIVE</b>: Previously the archiving was enabled by setting the property to 
&quot;TRUE&quot;. This is the same as to set 
                </p>

<div class="source"><pre class="prettyprint">
ARCHIVERS=org.signserver.server.archive.olddbarchiver.OldDatabaseArchiver
</pre></div>
                
<p>
Default: FALSE.
                </p>
                
<p>
See also the section about all <a href="plugins.html#Archivers">available Archivers</a>.
                </p>
            </div>

            
<div class="section">
<h2><a name="Accounter"></a>Accounter</h2>
                
<p>
An Accounter is responsible for somehow charging a client for a successful 
request or to deny the request if the client has insufficient funds.
                </p>
                
<p>
When a request has been processed, and if the worker marked the request as 
successfully fulfilled, the configured Accounter (if any) is called. The 
Accounter implementation could potentially query an external database and make a 
purchase for the service.
                </p>
                
<p>
The Accounter to use is configured using the ACCOUNTER worker property. By default no Accounter is used. Example:
                </p>

<div class="source"><pre class="prettyprint">
ACCOUNTER=org.signserver.server.GlobalConfigSampleAccounter
</pre></div>
                
<p>
See also the section about all <a href="plugins.html#Accounters">available Accounters</a>.
                </p>
            </div>

            
<div class="section">
<h2><a name="Checking_validity_of_signer_certificates"></a>Checking validity of signer certificates</h2>
                
<p>
By default the SignServer checks if the signer certificate of a signer is valid before letting the signer process a request. If the signers certificate is not valid an error message is returned.
There are two properties that can be set to disable this check:
                </p>
                
<p>
<b>CHECKCERTVALIDITY</b>: default value is true, meaning that the validity period of the certificate will be verified before processing. Set to false to ignore if the certificate is expired or not yet valid.
                </p>
                
<p>
<b>CHECKCERTPRIVATEKEYVALIDITY</b>: default value is true, meaning that the validity period in the PrivateKeyUsagePeriod of the certificate will be verified before processing. This is only done if this extension exists (it is optional in a certificate). Set to false to ignore the PrivateKeyUsagePeriod.
                </p>
                
<p>
<b>MINREMAININGCERTVALIDITY</b>: default value is 0. This property defines a minimum remaining validity time required of the signing certificate. If the signing certificate expires within the number of days specified an error occurs. Set to 0 (default) to disable this check.
				</p>
            </div>

			
<div class="section">
<h2><a name="Limiting_the_number_of_signatures"></a>Limiting the number of signatures</h2>
                
<p>
By default SignServer keeps track of the number of signings performed with each key by holding counters in the database that are updated for each signing. The following worker properties controls the key usage counter:    
                </p>
                
<p>
<b>KEYUSAGELIMIT</b> = Sets how many signatures that are allowed to be created
with the same key by this worker (default is -1 = no limit). After the limit has
been reached the worker is considered offline.

Note that the counter is per key and not per worker so if multiple workers share
the same key they will all increment the counter. This also means that the worker
is active again after it has gotten a new certificate/key.
                </p>
                
<p>
<b>DISABLEKEYUSAGECOUNTER</b> = By default all key usages are counted but by specifying this as &quot;TRUE&quot; key usages performed by this worker will not be counted. Disabling the key usage counter can be a gain in performance as it will be less database transactions. However, if you have requirements on the number of allowed signings for one worker make sure to not use the same key with another worker for which the counter is disabled as those uses will then be missed.
                </p>
                
<p>
The key usage counter can not be disabled for a worker if KEYUSAGELIMIT is also specified.
                </p>
			</div>
            
            
<div class="section">
<h2><a name="Other_properties"></a>Other properties</h2>
                
<p>
<b>DISABLED</b> = Setting this to true disables a worker. A disabled worker can not perform any operations and any requests to it will fail. However, disabled workers are not included in the Health check report. 
                </p>
                
<p>
<b>EXPLICITECC</b> = Setting this to true uses explicit domain parameters instead of NamedCurves when generating
a certificate request using the RenewalWorker or through to admin GUI. (default: false)
                </p>
                
<p>
<b>NOCERTIFICATES</b> = Setting this to true tells SignServer to not warn if no signer certificate is configured for this worker. This could be useful for special types of workers not performing any signing operations.
                </p>
            </div>

    

                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                   2006&#x2013;2016.
          All rights reserved.    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
